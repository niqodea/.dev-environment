#!/bin/sh

set -eu

PANE_ID="$1"

status="$(tmux show-options -pv -t $PANE_ID @status)"

if [ "$status" = 'idle' ]; then
    # Prefix pane id with % to escape the leading % character
    tmux display-message "Pane %$PANE_ID is idle, no command info to display"
    exit
fi

shell_pid=$(tmux display-message -p -t "$PANE_ID" '#{@shell_pid}')
info_command="ps --ppid \"$shell_pid\" -o etime,%cpu,%mem,stat,cmd --sort start_time"

tmux run-shell -t "$PANE_ID" "$info_command"
